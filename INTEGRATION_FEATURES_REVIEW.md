# 일정/장소/일기/지출 연동 기능 검토

## 현재 연동 상태

### ✅ 이미 구현된 연동
1. **일정 ↔ 지출**
   - 일정에서 지출 추가 가능
   - 지출에 `schedule_id` 필드로 연동
   - 지출 목록에서 연동된 일정 표시

2. **장소 → 일정**
   - 장소 상세에서 "일정에 추가" 기능
   - 장소 정보(이름, 도시, 메모)가 일정에 자동 입력

## 제안하는 추가 연동 기능

### 1. 일기 ↔ 일정 연동 (우선순위: 높음)

**목적**: 특정 일정에 대한 일기를 작성하고, 일기에서 해당 일정을 참조

**구현 방법**:
- `diaries` 테이블에 `schedule_id` 필드 추가 (nullable)
- 일기 작성 시 "일정과 연결" 옵션 제공
- 일정 상세에서 "일기 작성" 버튼 추가
- 일기 목록에서 연동된 일정 표시 및 클릭 시 일정으로 이동

**사용 시나리오**:
- "오페라 하우스 관람" 일정을 클릭 → "이 일정에 대한 일기 작성" 버튼
- 일기 작성 시 해당 일정의 정보(제목, 시간, 장소) 자동 입력
- 일기에서 "연동된 일정 보기" 링크로 일정 상세로 이동

**데이터베이스 변경**:
```sql
ALTER TABLE diaries ADD COLUMN schedule_id UUID REFERENCES schedules(id) ON DELETE SET NULL;
CREATE INDEX idx_diaries_schedule_id ON diaries(schedule_id);
```

---

### 2. 일기 ↔ 장소 연동 (우선순위: 중간)

**목적**: 특정 장소 방문에 대한 일기를 작성

**구현 방법**:
- `diaries` 테이블에 `place_id` 필드 추가 (nullable)
- 일기 작성 시 "장소와 연결" 옵션 제공
- 장소 상세에서 "이 장소에 대한 일기 작성" 버튼 추가
- 일기 목록에서 연동된 장소 표시

**사용 시나리오**:
- "타롱가 동물원" 장소를 클릭 → "이 장소 방문 일기 작성" 버튼
- 일기 작성 시 장소 정보(이름, 주소, 카테고리) 자동 입력
- 일기에서 "연동된 장소 보기" 링크로 장소 상세로 이동

**데이터베이스 변경**:
```sql
ALTER TABLE diaries ADD COLUMN place_id UUID REFERENCES places(id) ON DELETE SET NULL;
CREATE INDEX idx_diaries_place_id ON diaries(place_id);
```

---

### 3. 일정 ↔ 장소 강화 연동 (우선순위: 높음)

**목적**: 일정에 장소를 직접 연결하여 위치 정보와 상세 정보를 공유

**구현 방법**:
- `schedules` 테이블에 `place_id` 필드 추가 (nullable)
- 일정 작성/수정 시 "장소 선택" 드롭다운 추가
- 장소 선택 시 장소의 주소, 운영시간, 연락처 등이 일정 메모에 자동 추가
- 일정 상세에서 연동된 장소 정보 표시 및 "장소 상세 보기" 링크

**사용 시나리오**:
- 일정 추가 시 "장소 선택" 드롭다운에서 기존 장소 선택
- 선택한 장소의 정보가 일정에 자동 반영
- 일정 목록에서 장소 아이콘 표시로 시각적 구분

**데이터베이스 변경**:
```sql
ALTER TABLE schedules ADD COLUMN place_id UUID REFERENCES places(id) ON DELETE SET NULL;
CREATE INDEX idx_schedules_place_id ON schedules(place_id);
```

---

### 4. 일기 ↔ 지출 연동 (우선순위: 낮음)

**목적**: 특정 지출과 관련된 일기를 작성 (예: 비싼 식사에 대한 후기)

**구현 방법**:
- `diaries` 테이블에 `expense_id` 필드 추가 (nullable)
- 지출 상세에서 "이 지출에 대한 일기 작성" 버튼
- 일기 작성 시 지출 정보(금액, 카테고리, 장소) 자동 입력

**사용 시나리오**:
- "호주 랍스터 식사 - 150 AUD" 지출을 클릭 → "이 지출에 대한 후기 작성"
- 일기에서 지출 금액과 카테고리 정보 표시

**데이터베이스 변경**:
```sql
ALTER TABLE diaries ADD COLUMN expense_id UUID REFERENCES expenses(id) ON DELETE SET NULL;
CREATE INDEX idx_diaries_expense_id ON diaries(expense_id);
```

---

### 5. 장소 ↔ 지출 연동 (우선순위: 중간)

**목적**: 장소 방문 시 발생한 지출을 자동으로 연결

**구현 방법**:
- `expenses` 테이블에 `place_id` 필드 추가 (nullable)
- 지출 추가 시 "장소 선택" 옵션 제공
- 장소 상세에서 "이 장소에서의 지출" 목록 표시
- 장소별 지출 통계 제공

**사용 시나리오**:
- "시드니 오페라 하우스" 장소에서 지출 추가 시 장소 선택
- 장소 상세에서 "이 장소에서 총 250 AUD 지출" 표시
- 장소별 지출 내역 확인 가능

**데이터베이스 변경**:
```sql
ALTER TABLE expenses ADD COLUMN place_id UUID REFERENCES places(id) ON DELETE SET NULL;
CREATE INDEX idx_expenses_place_id ON expenses(place_id);
```

---

### 6. 통합 타임라인 뷰 (우선순위: 높음)

**목적**: 날짜별로 일정, 지출, 일기, 방문 장소를 한눈에 보기

**구현 방법**:
- 새로운 "타임라인" 페이지 생성 (`/timeline`)
- 날짜별로 모든 데이터를 시간순으로 정렬하여 표시
- 각 항목을 클릭하면 해당 상세 페이지로 이동
- 필터 기능: 일정만 보기, 지출만 보기 등

**표시 내용**:
```
2025-12-18 (Day 1)
  📅 09:00 - 시드니 하버 브리지 산책 (일정)
  📍 10:30 - 시드니 오페라 하우스 방문 (장소)
  💰 12:00 - 점심 식사 - 45 AUD (지출) [일정 연동]
  📔 20:00 - 오늘의 일기 (일기) [일정 연동]
```

**UI 구성**:
- 좌측: 날짜별 타임라인
- 우측: 선택한 날짜의 상세 정보
- 상단: 날짜 선택 및 필터

---

### 7. 연동 데이터 통계 및 인사이트 (우선순위: 중간)

**목적**: 연동된 데이터를 활용한 통계 및 분석

**제공 기능**:
1. **장소별 통계**
   - 방문 횟수
   - 총 지출 금액
   - 관련 일기 개수
   - 평균 만족도 (일기 기분 데이터 활용)

2. **일정별 통계**
   - 연동된 지출 총액
   - 관련 일기 개수
   - 완료 여부

3. **날짜별 요약**
   - 하루 동안의 일정, 지출, 일기, 방문 장소 개수
   - 하루 총 지출
   - 하루 평균 기분

---

## 구현 우선순위

### Phase 1 (즉시 구현 권장)
1. ✅ 일정 ↔ 장소 강화 연동
2. ✅ 일기 ↔ 일정 연동
3. ✅ 통합 타임라인 뷰

### Phase 2 (중기 구현)
4. ✅ 장소 ↔ 지출 연동
5. ✅ 일기 ↔ 장소 연동

### Phase 3 (선택적 구현)
6. ✅ 일기 ↔ 지출 연동
7. ✅ 연동 데이터 통계 및 인사이트

---

## 기술적 고려사항

### 데이터베이스 설계
- 모든 연동 필드는 `nullable`로 설정하여 기존 데이터와의 호환성 유지
- 외래 키 제약조건에 `ON DELETE SET NULL` 사용하여 부모 삭제 시 안전하게 처리
- 인덱스 추가로 조회 성능 최적화

### UI/UX 고려사항
- 연동된 항목은 시각적 표시 (배지, 아이콘, 링크)
- 연동 해제 기능 제공
- 연동된 항목 간 빠른 이동 (원클릭 네비게이션)
- 연동 상태를 명확히 표시

### 성능 최적화
- 연동된 데이터 조회 시 JOIN 최적화
- 타임라인 뷰는 페이지네이션 또는 가상 스크롤 적용
- 통계 계산은 캐싱 고려

---

## 사용자 시나리오 예시

### 시나리오 1: 완전한 연동 플로우
1. 장소 추가: "시드니 오페라 하우스"
2. 일정 추가: "오페라 하우스 관람" → 장소 선택
3. 일정에서 지출 추가: "입장료 50 AUD"
4. 일정에서 일기 작성: "오페라 하우스에서 멋진 공연을 봤다"
5. 타임라인에서 모든 정보를 한눈에 확인

### 시나리오 2: 역방향 연동
1. 일기 작성: "오늘 맛있는 식당에서 식사했다"
2. 일기에서 "장소 연결" → 기존 장소 선택 또는 새 장소 추가
3. 일기에서 "지출 연결" → 관련 지출 선택
4. 연결된 모든 정보가 자동으로 연동됨

---

## 결론

현재 일정 ↔ 지출 연동은 잘 작동하고 있습니다. 추가 연동 기능을 통해 사용자가 여행 데이터를 더욱 체계적으로 관리하고, 나중에 여행 추억을 더 풍부하게 되돌아볼 수 있을 것입니다.

가장 우선적으로 구현할 기능은:
1. **일정 ↔ 장소 강화 연동** (일정에 장소 직접 연결)
2. **일기 ↔ 일정 연동** (일정에 대한 일기 작성)
3. **통합 타임라인 뷰** (모든 데이터를 시간순으로 보기)

이 세 가지 기능만으로도 사용자 경험이 크게 향상될 것입니다.
